{% extends "_base.html" %}
{% import "macros.html" as macros %}

{% block header %}
<style type="text/css">
    main {
        max-width: 60rem;
        margin: 2rem auto;
    }
    h2 {
        margin: 4rem 0 2rem 2rem;
    }
    .texte {
        margin: 2rem 0.5rem;
        display: flex;
        justify-content: space-between;
        flex-wrap: nowrap;
    }
    .texte:first-child {
        margin-top: 2rem;
    }
    .texte nav {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        flex-direction: column;
        text-align: right;
        margin-left: 2rem;
    }
    .texte nav a {
        background: no-repeat right center url("{{ request.static_url('zam_repondeur:static/img/big_right.svg') }}");
    }
    .texte nav a {
        font-size: 1.1rem;
        padding-right: 1.8rem;
        background-position: 99% 42%;
        background-size: 5%;
    }
    .texte nav a:first-child {
        font-size: 1.7rem;
        padding-right: 2rem;
        background-position: right 40%;
        background-size: 7%;
    }
    .texte .details {
        line-height: 1.2;
    }
    .extra-button {
        text-align: center;
        margin-top: 1rem;
    }
        .extra-button a.button {
            color: #3167a6;
            border: 1px solid #3167a6;
        }
        .extra-button a.button:hover {
            background-color: #3167a6;
            color: white;
        }
    [draggable="true"] {
        background: white no-repeat 10px 10px url("{{ request.static_url('zam_repondeur:static/img/draganddrop.svg') }}");
    }
        [draggable="true"].highlighted {
            background-color: Gold;
        }
    .dropzone {
        height: 0;
        border: none;
        margin: 0 1rem;
        transition: height .1s;
    }
        .dropzone.highlighted {
            height: 1.5rem;
            background: LightGoldenRodYellow;
            transition: height .5s;
        }
        .dropzone.highlighted.hover {
            background: Gold;
        }
</style>
{% endblock %}

{% block main_class %}{% endblock %}

{% block body %}
    <section data-controller="textes-order"
        data-target="textes-order.parent"
        data-textes-order-url="{{ request.resource_url(context, 'order') }}">
        <h2>{{ seance }}</h2>
        <div class="dropzone"
            data-target="textes-order.dropzone"
            data-action="
                drag->textes-order#dragging
                dragover->textes-order#preventDefault
                dragenter->textes-order#highlightDropzone
                dragleave->textes-order#downlightDropzone
                drop->textes-order#reorder
            "></div>
        {% for lecture in lectures %}
            <div draggable="true" class="texte box"
                data-action="
                    drag->textes-order#dragging
                    dragstart->textes-order#registerDragged
                    dragstart->textes-order#showDropzones
                    dragend->textes-order#hideDropzones
                "
                data-target="textes-order.texte"
                data-pk="{{ lecture.pk }}">
                <h3>{{ lecture.dossier.titre }}</h3>
                <nav>
                    <a href="{{ request.resource_url(request.root['seances'][seance.slug]['textes'][lecture.dossier.slug]['amendements']) }}">
                        Accéder à ce texte
                    </a>
                    {% if seance.is_past_deadline %}
                        <a href="{{ request.resource_url(request.root['seances'][seance.slug]['textes'][lecture.dossier.slug]['derouleur']) }}">
                            Accéder au dérouleur
                        </a>
                    {% endif %}
                </nav>
            </div>
            <div class="dropzone"
                data-target="textes-order.dropzone"
                data-action="
                    drag->textes-order#dragging
                    dragover->textes-order#preventDefault
                    dragenter->textes-order#highlightDropzone
                    dragleave->textes-order#downlightDropzone
                    drop->textes-order#reorder
                "></div>
        {% else %}
            <div class="texte box">
                <h3>Aucun texte pour l’instant.</h3>
            </div>
        {% endfor %}
    </section>
    <div class="extra-button box">
        <a class="button primary" href="{{ request.resource_url(context, 'add') }}">
            Ajouter un texte
        </a>
    </div>
{% endblock %}

{% block scripts %}
    {% if lectures | length > 1 %}
        <script src="{{ request.static_url('zam_repondeur:static/js/seance.js') }}"></script>
    {% endif %}
{% endblock %}
