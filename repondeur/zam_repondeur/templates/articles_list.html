<!doctype html>
<html lang=fr>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1,shrink-to-fit=no">
<title>{{ lecture.dossier_legislatif }} — {{ lecture }}</title>
<link rel=icon href="data:;base64,iVBORw0KGgo=">
<link rel="stylesheet" type="text/css" href="{{ request.static_url('zam_repondeur:static/css/visionneuse.css') }}">
<style type="text/css">
  section:first-child .titles {
    align-items: center;
    text-align: center;
    margin: 1.5rem;
  }
  section {
    margin-bottom: 1.5rem;
  }
  .home {
    color: black;
    font-family: "source_sans_pro";
  }
    .home h2 {
      font-weight: 600;
      display: block;
      width: 100%;
    }
  .arrow-right {
    display: block;
    background-position: center right;
    background-size: 1.5rem;
    background-image: url("{{ request.static_url('zam_repondeur:static/img/big_right_gray.svg') }}");
    color: black;
  }
  .search header {
    min-height: inherit;
  }
    .search .titles {
      align-items: center;
      font-size: 1.1rem;
    }
    .search #q {
      margin-left: .5rem;
      border: 1px solid #979797;
      padding: .2rem;
      background: no-repeat 93% center/12% url("{{ request.static_url('zam_repondeur:static/img/loupe_gray.svg') }}");
    }
</style>
{# See https://inclusive-components.design/notifications/ #}
<div role="status" aria-live="polite"></div>
<header class="main">
  <nav>
    <span></span>
    <span><a class="find" href="">Accès amendement</a></span>
    <form method="get" role="search" action="">
      <input name="q" id="q" type="number" min="1" step="1" required placeholder="Numéro">
      <input type="submit" name="submit" value="Accès amendement">
      <p class="error hide">Amendement non trouvé.</p>
    </form>
  </nav>
</header>
<main>
  <section>
    <header>
      <div class="wrapper">
        <div class="titles">
          <h2>{{ lecture.dossier_legislatif }}</h2>
        </div>
      </div>
    </header>
  </section>
  <section class="search">
    <header>
      <div class="wrapper">
        <div class="titles home">
          <form id="search-article" method="get" role="search" action="">
            Article nº
            <input name="q" id="q" type="number" min="1" step="1" placeholder="Numéro">
            <input type="submit" name="submit" value="Valider">
            <p class="error hide">Article non trouvé.</p>
          </form>
        </div>
      </div>
    </header>
  </section>
  {% for article in articles %}
    {% if article.slug %}
      <section id="{{ article.slug }}" data-article-num="{{ article.num }}">
        <header>
          <div class="wrapper">
            <div class="titles home">
              <h2><a class="arrow-right" href="{{ request.resource_url(context, article.url_key, 'reponses') }}">{{ article.format(short=False) }}</a></h2>
              {% if article.titre == "TODO" %}
                <h3>{{ loop.previtem.titre or "" }}</h3>
              {% else %}
                <h3>{{ article.titre or "" }}</h3>
              {% endif %}
            </div>
          </div>
        </header>
      </section>
    {% endif %}
  {% endfor %}
</main>
<script type="text/javascript">
  ;(function filterArticles () {
    const form = document.querySelector('#search-article')
    const input = form.querySelector('input[name="q"]')
    const allArticles = Array.from(document.querySelectorAll('[data-article-num]'))
    form.addEventListener('submit', e => {
      e.preventDefault()
      const form = e.target
      const data = new FormData(form)
      const value = data.get('q').trim()
      if (!value) {
        allArticles.forEach(article => {
          article.classList.remove('is-hidden')
        })
        return
      }
      const articles = Array.from(document.querySelectorAll(`[data-article-num="${value}"]`))
      if (articles.length) {
        allArticles.forEach(article => {
          article.classList.toggle('is-hidden', articles.indexOf(article) === -1)
        })
      } else {
        allArticles.forEach(article => {
          article.classList.remove('is-hidden')
        })
        form.querySelector('.error').classList.remove('hide')
      }
    })
    input.addEventListener('keydown', e => {
      input.parentElement.querySelector('.error').classList.add('hide')
    })

  })()
</script>
</html>
